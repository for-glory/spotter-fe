"use strict";(self["webpackChunkspotter"]=self["webpackChunkspotter"]||[]).push([[663],{67679:function(e,t,a){a.r(t),a.d(t,{default:function(){return E}});var n=a(66252),s=a(2262),l=a(3577),r=a(10121),d=a(19239),i=a(96647),c=a(31810),o=a(85638),u=a(73050),h=a(22201),p=a(68889),_=a(78223),w=a(41419),m=a(88520),f=a(87794),v=a(49316),g=a(23279),y=a.n(g),k=a(18354),b=a(47330);const C={key:1,class:"cards"},S={key:0,class:"cards__container"};var P=(0,n.aZ)({__name:"ChoosePaymentMethod",setup(e){const t={NODE_ENV:"production",VUE_APP_API_URL:"https://api.spotterfitness.com/graphql",VUE_APP_GOOGLE_AUTH_CLIENT_ID:"",BASE_URL:"/"}.VUE_APP_STRIPE_PUBLIC_KEY,a=(0,s.iH)(!1),g=(0,s.iH)([]),P=(0,s.iH)(""),U=(0,h.tv)(),E=(0,h.yj)(),I=new _.o,A=(0,s.iH)(null),L=new p.R(t||"");(0,n.Ah)((()=>{clearInterval(A.value)}));const{loading:H,load:K,onResult:Z}=(0,v.td)(f.en,{fetchPolicy:"no-cache"});K();const{type:R}=(0,b.Z)();Z((({data:e})=>{e.me.currentSubscription!==R&&((0,k.H9)(e.me),G())})),(0,n.bv)((()=>{D(),L.init(),m.hK.initialize({publishableKey:t}),A.value=setInterval((()=>{D()}),5e3)}));const{mutate:T}=L.changePaymentMethod(),{mutate:Y}=L.createSubscriptionIntent(),{onResult:j,refetch:D}=L.getCards(),W=y()((()=>{D()}),5e3);W();const N=()=>{P.value="",Y({product_id:E.params.subscriptionId,facility_id:E.query.facilityId}).then((e=>{console.log("data==>",e);let t=JSON.parse(e?.data?.createSubscriptionIntent?.session);L.redirectToCheckout(t.id)})).catch((e=>{throw P.value=e,new Error(e)})),a.value&&(a.value=!a.value)};j((e=>{I.init(e?.data?.cards?.data||[]),g.value=I.cards}));const O=e=>{T({card_id:e}).then((()=>{g.value.forEach((t=>{t.is_default=t.id===e}))})).catch((e=>{throw P.value=e,new Error(e)}))},x=async()=>{const{onResult:e}=L.createSetupIntent();e((e=>{let t=JSON.parse(e?.data?.setupIntent?.session);L.redirectToCardSaving(t.id,t.url)}))},G=()=>{U.go(-1)};return m.hK.addListener(m.YT.Completed,(()=>{})),m.hK.addListener(m.YT.Failed,(()=>{P.value="Something went wrong, please try again"})),m.hK.addListener(m.uA.Completed,(()=>{})),m.hK.addListener(m.uA.Failed,(()=>{P.value="Something went wrong, please try again"})),(e,t)=>((0,n.wg)(),(0,n.j4)(r.Z,{"full-width-footer":!1},{header:(0,n.w5)((()=>[(0,n.Wm)(d.Z,{"back-btn":"",onBack:G,title:"Payment"})])),content:(0,n.w5)((()=>[(0,s.SU)(H)?((0,n.wg)(),(0,n.j4)((0,s.SU)(c.PQ),{key:0,class:"spinner",name:"lines"})):((0,n.wg)(),(0,n.iD)(n.HY,{key:1},[a.value?((0,n.wg)(),(0,n.j4)(i.Z,{key:0})):((0,n.wg)(),(0,n.iD)("div",C,[(0,n.Wm)((0,s.SU)(c.wd),{class:"cards__title"},{default:(0,n.w5)((()=>[(0,n.Uk)("Payment Method")])),_:1}),g.value?.length?((0,n.wg)(),(0,n.iD)("div",S,[(0,n.Wm)(u.Z,{"show-start":"",items:g.value,"slides-offset-after":16,"slides-offset-before":16},{start:(0,n.w5)((()=>[(0,n.Wm)((0,s.SU)(c.YG),{onClick:x,class:"add-card"},{default:(0,n.w5)((()=>[(0,n.Wm)((0,s.SU)(c.gu),{src:"assets/icon/payment/plus.svg",class:"add-icon"})])),_:1})])),default:(0,n.w5)((e=>[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(e,(e=>((0,n.wg)(),(0,n.j4)(o.Z,{key:e.id,"card-holder":e.card_holder,"card-number":e.pm_last_four,"exp-date":e.exp_month+"/"+e.exp_year,"is-default":e.is_default,class:"card-slide",onClick:t=>O(e.id)},null,8,["card-holder","card-number","exp-date","is-default","onClick"])))),128))])),_:1},8,["items"])])):((0,n.wg)(),(0,n.j4)(w.Z,{key:1,class:"add-card-btn",onClick:x}))]))],64))])),footer:(0,n.w5)((()=>[(0,n.Wm)((0,s.SU)(c.YG),{onClick:N,class:"submit-btn",disabled:g.value.length<1},{default:(0,n.w5)((()=>[(0,n.Uk)((0,l.zw)(g.value.length<1?"Create card":"Confirm"),1)])),_:1},8,["disabled"])])),_:1}))}});const U=P;var E=U}}]);
//# sourceMappingURL=663.271e1f51.js.map