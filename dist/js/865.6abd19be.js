"use strict";(self["webpackChunkspotter"]=self["webpackChunkspotter"]||[]).push([[865],{20865:function(e,t,i){i.r(t),i.d(t,{StripeWeb:function(){return E}});var n=i(29895),a=i(28308);const s=e=>o(e),r=(e,t)=>("string"===typeof e&&(t=e,e=void 0),s(e).includes(t)),o=(e=window)=>{if("undefined"===typeof e)return[];e.Ionic=e.Ionic||{};let t=e.Ionic.platforms;return null==t&&(t=e.Ionic.platforms=l(e),t.forEach((t=>e.document.documentElement.classList.add(`plt-${t}`)))),t},l=e=>Object.keys(g).filter((t=>g[t](e))),p=e=>w(e)&&!S(e),h=e=>!!L(e,/iPad/i)||!(!L(e,/Macintosh/i)||!w(e)),c=e=>L(e,/iPhone/i),u=e=>L(e,/iPhone|iPod/i)||h(e),y=e=>L(e,/android|sink/i),m=e=>y(e)&&!L(e,/mobile/i),d=e=>{const t=e.innerWidth,i=e.innerHeight,n=Math.min(t,i),a=Math.max(t,i);return n>390&&n<520&&a>620&&a<800},b=e=>{const t=e.innerWidth,i=e.innerHeight,n=Math.min(t,i),a=Math.max(t,i);return h(e)||m(e)||n>460&&n<820&&a>780&&a<1400},w=e=>q(e,"(any-pointer:coarse)"),f=e=>!w(e),S=e=>P(e)||v(e),P=e=>!!(e["cordova"]||e["phonegap"]||e["PhoneGap"]),v=e=>{const t=e["Capacitor"];return!!(null===t||void 0===t?void 0:t.isNative)},A=e=>L(e,/electron/i),C=e=>!(!e.matchMedia("(display-mode: standalone)").matches&&!e.navigator.standalone),L=(e,t)=>t.test(e.navigator.userAgent),q=(e,t)=>e.matchMedia(t).matches,g={ipad:h,iphone:c,ios:u,android:y,phablet:d,tablet:b,cordova:P,capacitor:v,electron:A,pwa:C,mobile:w,mobileweb:p,desktop:f,hybrid:S};class E extends n.Uw{constructor(){super({name:"Stripe",platforms:["web"]})}async initialize(e){if("string"!==typeof e.publishableKey||0===e.publishableKey.trim().length)throw new Error("you must provide a valid key");this.publishableKey=e.publishableKey,e.stripeAccount&&(this.stripeAccount=e.stripeAccount)}async createPaymentSheet(e){var t;this.publishableKey?(this.paymentSheet=document.createElement("stripe-payment-sheet"),null===(t=document.querySelector("body"))||void 0===t||t.appendChild(this.paymentSheet),await customElements.whenDefined("stripe-payment-sheet"),this.paymentSheet.publishableKey=this.publishableKey,this.stripeAccount&&(this.paymentSheet.stripeAccount=this.stripeAccount),this.paymentSheet.applicationName="@capacitor-community/stripe",this.paymentSheet.intentClientSecret=e.paymentIntentClientSecret,this.paymentSheet.intentType="payment",void 0!==e.withZipCode&&(this.paymentSheet.zip=e.withZipCode),this.notifyListeners(a.YG.Loaded,null)):this.notifyListeners(a.YG.FailedToLoad,null)}async presentPaymentSheet(){if(!this.paymentSheet)throw new Error;const e=await this.paymentSheet.present();if(void 0===e)return this.notifyListeners(a.YG.Canceled,null),{paymentResult:a.YG.Canceled};const{detail:{stripe:t,cardNumberElement:i}}=e,n=await t.createPaymentMethod({type:"card",card:i});return this.paymentSheet.updateProgress("success"),this.paymentSheet.remove(),void 0!==n.error?(this.notifyListeners(a.YG.Failed,null),{paymentResult:a.YG.Failed}):(this.notifyListeners(a.YG.Completed,null),{paymentResult:a.YG.Completed})}async createPaymentFlow(e){var t;this.publishableKey?(this.paymentSheet=document.createElement("stripe-payment-sheet"),null===(t=document.querySelector("body"))||void 0===t||t.appendChild(this.paymentSheet),await customElements.whenDefined("stripe-payment-sheet"),this.paymentSheet.publishableKey=this.publishableKey,this.stripeAccount&&(this.paymentSheet.stripeAccount=this.stripeAccount),this.paymentSheet.applicationName="@capacitor-community/stripe",e.hasOwnProperty("paymentIntentClientSecret")?(this.paymentSheet.intentType="payment",this.paymentSheet.intentClientSecret=e.paymentIntentClientSecret):(this.paymentSheet.intentType="setup",this.paymentSheet.intentClientSecret=e.setupIntentClientSecret),void 0!==e.withZipCode&&(this.paymentSheet.zip=e.withZipCode),r(window,"ios")?(this.paymentSheet.buttonLabel="Add card",this.paymentSheet.sheetTitle="Add a card"):this.paymentSheet.buttonLabel="Add",this.notifyListeners(a.I.Loaded,null)):this.notifyListeners(a.I.FailedToLoad,null)}async presentPaymentFlow(){if(!this.paymentSheet)throw new Error;this.notifyListeners(a.I.Opened,null);const e=await this.paymentSheet.present().catch((()=>{}));if(void 0===e)throw this.notifyListeners(a.I.Canceled,null),new Error;const{detail:{stripe:t,cardNumberElement:i}}=e,{token:n}=await t.createToken(i);if(void 0===n||void 0===n.card)throw new Error;return this.flowStripe=t,this.flowCardNumberElement=i,this.notifyListeners(a.I.Created,{cardNumber:n.card.last4}),{cardNumber:n.card.last4}}async confirmPaymentFlow(){if(!this.paymentSheet||!this.flowStripe||!this.flowCardNumberElement)throw new Error;const e=await this.flowStripe.createPaymentMethod({type:"card",card:this.flowCardNumberElement});return void 0!==e.error&&this.notifyListeners(a.I.Failed,null),this.paymentSheet.updateProgress("success"),this.paymentSheet.remove(),this.notifyListeners(a.I.Completed,null),{paymentResult:a.I.Completed}}isApplePayAvailable(){return this.isAvailable("applePay")}async createApplePay(e){this.publishableKey?(this.requestApplePay=await this.createPaymentRequestButton(),this.requestApplePayOptions=e,this.notifyListeners(a.YT.Loaded,null)):this.notifyListeners(a.YT.FailedToLoad,null)}presentApplePay(){return this.presentPaymentRequestButton("applePay",this.requestApplePay,this.requestApplePayOptions,a.YT)}isGooglePayAvailable(){return this.isAvailable("googlePay")}async createGooglePay(e){this.publishableKey?(this.requestGooglePay=await this.createPaymentRequestButton(),this.requestGooglePayOptions=e,this.notifyListeners(a.uA.Loaded,null)):this.notifyListeners(a.uA.FailedToLoad,null)}presentGooglePay(){return this.presentPaymentRequestButton("googlePay",this.requestGooglePay,this.requestGooglePayOptions,a.uA)}async isAvailable(e){var t;const i=document.createElement("stripe-payment-request-button");return i.id=`isAvailable-${e}`,null===(t=document.querySelector("body"))||void 0===t||t.appendChild(i),await customElements.whenDefined("stripe-payment-request-button"),this.publishableKey&&(i.publishableKey=this.publishableKey),this.stripeAccount&&(i.stripeAccount=this.stripeAccount),i.applicationName="@capacitor-community/stripe",await i.isAvailable(e).finally((()=>i.remove()))}async createPaymentRequestButton(){var e;const t=document.createElement("stripe-payment-request-button");return null===(e=document.querySelector("body"))||void 0===e||e.appendChild(t),await customElements.whenDefined("stripe-payment-request-button"),this.publishableKey&&(t.publishableKey=this.publishableKey),this.stripeAccount&&(t.stripeAccount=this.stripeAccount),t.applicationName="@capacitor-community/stripe",t}async presentPaymentRequestButton(e,t,i,n){return new Promise((async a=>{if(void 0===t||void 0===i||void 0===this.publishableKey)return this.notifyListeners(n.Failed,null),a({paymentResult:n.Failed});await t.setPaymentRequestOption({country:i.countryCode.toUpperCase(),currency:i.currency.toLowerCase(),total:i.paymentSummaryItems[i.paymentSummaryItems.length-1],disableWallets:"applePay"===e?["googlePay","browserCard"]:["applePay","browserCard"],requestPayerName:!0,requestPayerEmail:!0});const s=i.paymentIntentClientSecret;await t.setPaymentMethodEventHandler((async(e,t)=>{const{paymentIntent:i,error:r}=await t.confirmCardPayment(s,{payment_method:e.paymentMethod.id},{handleActions:!1});if(r)return e.complete("fail"),this.notifyListeners(n.Failed,r),a({paymentResult:n.Failed});if("requires_action"===(null===i||void 0===i?void 0:i.status)){const{error:i}=await t.confirmCardPayment(s);if(i)return e.complete("fail"),this.notifyListeners(n.Failed,i),a({paymentResult:n.Failed})}return e.complete("success"),this.notifyListeners(n.Completed,null),a({paymentResult:n.Completed})})),await t.initStripe(this.publishableKey,{stripeAccount:this.stripeAccount,showButton:!1})}))}}}}]);
//# sourceMappingURL=865.6abd19be.js.map