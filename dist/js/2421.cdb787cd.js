"use strict";(self["webpackChunkspotter"]=self["webpackChunkspotter"]||[]).push([[2421],{48333:function(e,a,t){t.d(a,{Z:function(){return d}});var n=t(66252),l=t(2262),r=t(3577),s=t(31810),o=(0,n.aZ)({__name:"PaymentMethod",props:{id:{},icon:{},title:{}},setup(e){return(e,a)=>((0,n.wg)(),(0,n.j4)((0,l.SU)(s.YG),{id:`${e.icon}`,class:(0,r.C_)(["payment-method__btn",{"payment-method__btn--google-pay":"googlePay"===e.id}])},{default:(0,n.w5)((()=>[(0,n.Wm)((0,l.SU)(s.gu),{class:"payment-method__icon",src:`assets/icon/payment/${e.icon}.svg`},null,8,["src"]),(0,n.Wm)((0,l.SU)(s.yW),{class:"payment-method__title"},{default:(0,n.w5)((()=>[(0,n.Uk)((0,r.zw)(e.title),1)])),_:1})])),_:1},8,["id","class"]))}}),i=t(83744);const c=(0,i.Z)(o,[["__scopeId","data-v-a422b7f8"]]);var d=c},33056:function(e,a,t){t.r(a),t.d(a,{default:function(){return K}});var n=t(66252),l=t(2262),r=t(3577),s=t(10121),o=t(19239),i=t(96647),c=t(31810),d=t(45241),u=t(48333),p=t(85638),y=t(73050),m=t(22201),_=t(68889),h=t(49316),v=t(35506),g=t(87794);(0,h.UK)((0,v.Z)());class w{createPaypalToken(){return(0,h.aM)(g.bU)}makePaymentRequest(){return(0,h.Db)(g.ws)}}var P=t(78223),f=t(41419),k=t(88520),b=t(17285),C=t(23279),U=t.n(C);const I={key:1,class:"cards"},S={key:0,class:"cards__container"},E={key:2,class:"separator"},A={class:"payment__methods"};var H=(0,n.aZ)({__name:"ChoosePaymentMethod",setup(e){const a=(0,l.iH)([{icon:"apple",title:"Pay",key:"applePay",isHidden:!0},{icon:"google",title:"Pay with Google Pay",key:"googlePay",isHidden:!0},{icon:"paypal",title:"PayPal",key:"paypal",isHidden:!0}]),t={NODE_ENV:"production",VUE_APP_API_URL:"https://api.spotterfitness.com/graphql",VUE_APP_GOOGLE_AUTH_CLIENT_ID:"",BASE_URL:"/"}.VUE_APP_STRIPE_PUBLIC_KEY,v={NODE_ENV:"production",VUE_APP_API_URL:"https://api.spotterfitness.com/graphql",VUE_APP_GOOGLE_AUTH_CLIENT_ID:"",BASE_URL:"/"}.VUE_APP_APPLE_MERCHANT_ID,C=(0,l.iH)(!1),H=(0,l.iH)([]),G=(0,l.iH)(""),K=(0,l.iH)(),R=(0,l.iH)(),D=(0,m.tv)(),L=(0,m.yj)(),T=new P.o,q=(0,l.iH)(!1),W=(0,l.iH)(!0),j=(0,l.iH)(null),N=new _.R(t||""),Z=new w;(0,n.Ah)((()=>{clearInterval(j.value)}));const{result:O,loading:M}=(0,h.aM)(g.tt,{id:L.query.cart_id},{fetchPolicy:"no-cache"});(0,n.bv)((()=>{x(),de.value?q.value=!0:(N.init(),k.hK.initialize({publishableKey:t}).then((()=>{oe(),ie()})),$(),j.value=setInterval((()=>{x()}),5e3))}));const{mutate:Y}=N.changePaymentMethod(),{mutate:V}=N.createPaymentIntent(),{onResult:z,refetch:x}=N.getCards(),J=U()((()=>{x()}),5e3);J();const{onResult:B}=Z.createPaypalToken(),{mutate:F}=Z.makePaymentRequest(),$=()=>{const e=document.createElement("script");e.src="https://js.braintreegateway.com/js/braintree-2.32.1.min.js",e.addEventListener("load",X()),document.body.appendChild(e)},Q=(0,n.Fl)((()=>O.value?.getCart?.items)),X=()=>{Q.value?.length<1?G.value="Paypal not initialized: select the products first.":B((e=>{let t;a.value.forEach((e=>{q.value||"paypal"!==e.key||(e.isHidden=!1)})),braintree.setup(e?.data?.paypalToken?.token,"custom",{paypal:{container:"paypal"},onReady:function(e){t=e},onError:function(){X()},onCancelled:()=>{t.teardown((()=>{t=null})),X()},onPaymentMethodReceived:e=>{t.teardown((()=>{t=null,ee(e.nonce)}))}})}))},ee=e=>{G.value="",F({cart_id:L.query.cart_id,nonce:e}).then((e=>{const a=JSON.parse(e?.data?.payWithPaypal?.result);if(!0===a.success)return(0,b.C)(L.params.orderId,L.query.cart_id),!0;G.value=a.message})).catch((e=>{const a=e?.data?.payWithPaypal?.result;return G.value=a.message,!1})),X()},ae=()=>{G.value="",Q.value?.length<1?G.value="Select the products first.":(V({cart_id:L.query.cart_id,purchasable_product_id:L.params.orderId}).then((e=>{let a=e?.data?.paymentIntent?.zeroPayment;a&&(0,b.C)(L.params.orderId,L.query.cart_id);let t=JSON.parse(e?.data?.paymentIntent?.session);N.redirectToCheckout(t.id)})).catch((e=>{throw G.value=e,new Error(e)})),C.value&&(C.value=!C.value))};z((e=>{T.init(e?.data?.cards?.data||[]),H.value=T.cards}));const te=e=>{Y({card_id:e}).then((()=>{H.value.forEach((a=>{a.is_default=a.id===e}))})).catch((e=>{throw G.value=e,new Error(e)}))},ne=async()=>{const{onResult:e}=N.createSetupIntent(L.params.orderId);e((e=>{let a=JSON.parse(e?.data?.setupIntent?.session);N.redirectToCardSaving(a.id,a.url)}))},le=()=>{D.go(-1)};k.hK.addListener(k.YT.Completed,(()=>{(0,b.C)(L.params.orderId,L.query.cart_id)})),k.hK.addListener(k.YT.Failed,(()=>{G.value="Something went wrong, please try again"})),k.hK.addListener(k.uA.Completed,(()=>{(0,b.C)(L.params.orderId,L.query.cart_id)})),k.hK.addListener(k.uA.Failed,(()=>{G.value="Something went wrong, please try again"}));const re=async e=>{switch(e){case"applePay":await se();break;case"googlePay":await ce();break;default:break}},se=async()=>{if(W.value){const{onResult:e}=N.createAppleGooglePaymentIntent({cart_id:L.query.cart_id,provider:g.tT.Apple});e((async e=>{const a=JSON.parse(e.data.appleGooglePaymentIntent.paymentIntent);await k.hK.createApplePay({paymentIntentClientSecret:a.client_secret,paymentSummaryItems:[{label:Q.value[0].productable?.title,amount:Q.value[0].productable?.price/100}],merchantIdentifier:v,countryCode:"US",currency:"USD"}),await k.hK.presentApplePay()}))}else{const e=await c.Mn.create({message:"Please, add a card to Apple Wallet to use with Apple Pay",duration:3e3,icon:"assets/icon/info.svg",cssClass:"warning-toast"});e.present()}},oe=async()=>{K.value=k.hK.isGooglePayAvailable().then((()=>{a.value.forEach((e=>{"googlePay"===e.key&&(e.isHidden=!1)}))})).catch((()=>{}))},ie=async()=>{R.value=k.hK.isApplePayAvailable().then((()=>(a.value.forEach((e=>{"applePay"===e.key&&(e.isHidden=!1)})),!0))).catch((async e=>{if(e&&"Can not use on this Device."===e.errorMessage&&(0,d.a)("ios"))return W.value=!1,a.value.forEach((e=>{"applePay"===e.key&&(e.isHidden=!1)})),!0}))},ce=async()=>{if(void 0===K.value)return;const{onResult:e}=N.createAppleGooglePaymentIntent({cart_id:L.query.cart_id,provider:g.tT.Google});e((async e=>{const a=JSON.parse(e.data.appleGooglePaymentIntent.paymentIntent);await k.hK.createGooglePay({paymentIntentClientSecret:a.client_secret,paymentSummaryItems:[{label:Q.value[0].productable?.title,amount:Q.value[0].productable?.price/100}],merchantIdentifier:v,countryCode:"US",currency:"USD"}),await k.hK.presentGooglePay()}))},de=(0,n.Fl)((()=>0===O.value?.getCart?.items[0].productable?.booked_count));return(e,t)=>((0,n.wg)(),(0,n.j4)(s.Z,{"full-width-footer":!1},{header:(0,n.w5)((()=>[(0,n.Wm)(o.Z,{"back-btn":"",onBack:le,title:"Payment"})])),content:(0,n.w5)((()=>[(0,l.SU)(M)?((0,n.wg)(),(0,n.j4)((0,l.SU)(c.PQ),{key:0,class:"spinner",name:"lines"})):((0,n.wg)(),(0,n.iD)(n.HY,{key:1},[C.value?((0,n.wg)(),(0,n.j4)(i.Z,{key:0})):((0,n.wg)(),(0,n.iD)("div",I,[(0,n.Wm)((0,l.SU)(c.wd),{class:"cards__title"},{default:(0,n.w5)((()=>[(0,n.Uk)("Payment Method")])),_:1}),H.value?.length?((0,n.wg)(),(0,n.iD)("div",S,[(0,n.Wm)(y.Z,{"show-start":"",items:H.value,"slides-offset-after":16,"slides-offset-before":16},{start:(0,n.w5)((()=>[(0,n.Wm)((0,l.SU)(c.YG),{onClick:ne,class:"add-card"},{default:(0,n.w5)((()=>[(0,n.Wm)((0,l.SU)(c.gu),{src:"assets/icon/payment/plus.svg",class:"add-icon"})])),_:1})])),default:(0,n.w5)((e=>[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(e,(e=>((0,n.wg)(),(0,n.j4)(p.Z,{key:e.id,"card-holder":e.card_holder,"card-number":e.pm_last_four,"exp-date":e.exp_month+"/"+e.exp_year,"is-default":e.is_default,class:"card-slide",onClick:a=>te(e.id)},null,8,["card-holder","card-number","exp-date","is-default","onClick"])))),128))])),_:1},8,["items"])])):((0,n.wg)(),(0,n.j4)(f.Z,{key:1,class:"add-card-btn",onClick:ne}))])),q.value?((0,n.wg)(),(0,n.j4)((0,l.SU)(c.wd),{key:3,class:"separator text-align-center"},{default:(0,n.w5)((()=>[(0,n.Uk)('Products you\'ve chosen are free. Click "Confirm" button to continue.')])),_:1})):((0,n.wg)(),(0,n.iD)("div",E,[(0,n.Wm)((0,l.SU)(c.yW),{class:"optional"},{default:(0,n.w5)((()=>[(0,n.Uk)("or pay with")])),_:1})])),(0,n._)("div",A,[G.value?((0,n.wg)(),(0,n.j4)((0,l.SU)(c.uN),{key:0},{default:(0,n.w5)((()=>[(0,n.Uk)((0,r.zw)(G.value),1)])),_:1})):(0,n.kq)("",!0),((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(a.value,(e=>((0,n.wg)(),(0,n.j4)(u.Z,{icon:e.icon,title:e.title,key:e.key,id:e.key,hidden:e.isHidden,onClick:a=>re(e.key)},null,8,["icon","title","id","hidden","onClick"])))),128))])],64))])),footer:(0,n.w5)((()=>[(0,n.Wm)((0,l.SU)(c.YG),{onClick:ae,class:"submit-btn",disabled:H.value.length<1},{default:(0,n.w5)((()=>[(0,n.Uk)((0,r.zw)(H.value.length<1?"Create card":"Confirm"),1)])),_:1},8,["disabled"])])),_:1}))}});const G=H;var K=G}}]);
//# sourceMappingURL=2421.cdb787cd.js.map