"use strict";(self["webpackChunkspotter"]=self["webpackChunkspotter"]||[]).push([[663],{67679:function(e,t,a){a.r(t),a.d(t,{default:function(){return P}});var n=a(66252),s=a(2262),l=a(3577),d=a(10121),r=a(19239),i=a(96647),c=a(31810),o=a(85638),u=a(73050),h=a(22201),w=a(68889),p=a(78223),m=a(41419),f=a(88520),v=a(87794),_=a(49316),g=a(23279),y=a.n(g),k=a(18354),b=a(47330);const S={key:1,class:"cards"},C={key:0,class:"cards__container"};var U=(0,n.aZ)({__name:"ChoosePaymentMethod",setup(e){const t={NODE_ENV:"production",BASE_URL:"/"}.VUE_APP_STRIPE_PUBLIC_KEY,a=(0,s.iH)(!1),g=(0,s.iH)([]),U=(0,s.iH)(""),I=(0,h.tv)(),P=(0,h.yj)(),E=new p.o,K=(0,s.iH)(null),Z=new w.R(t||"");(0,n.Ah)((()=>{clearInterval(K.value)}));const{loading:H,load:Y,onResult:j}=(0,_.td)(v.en,{fetchPolicy:"no-cache"});Y();const{type:L}=(0,b.Z)();j((({data:e})=>{e.me.currentSubscription!==L&&((0,k.H9)(e.me),M())})),(0,n.bv)((()=>{D(),Z.init(),f.hK.initialize({publishableKey:t}),K.value=setInterval((()=>{D()}),5e3)}));const{mutate:R}=Z.changePaymentMethod(),{mutate:W}=Z.createSubscriptionIntent(),{onResult:A,refetch:D}=Z.getCards(),T=y()((()=>{D()}),5e3);T();const x=()=>{U.value="",W({product_id:P.params.subscriptionId,facility_id:P.query.facilityId}).then((e=>{console.log("data==>",e);let t=JSON.parse(e?.data?.createSubscriptionIntent?.session);Z.redirectToCheckout(t.id)})).catch((e=>{throw U.value=e,new Error(e)})),a.value&&(a.value=!a.value)};A((e=>{E.init(e?.data?.cards?.data||[]),g.value=E.cards}));const N=e=>{R({card_id:e}).then((()=>{g.value.forEach((t=>{t.is_default=t.id===e}))})).catch((e=>{throw U.value=e,new Error(e)}))},B=async()=>{const{onResult:e}=Z.createSetupIntent();e((e=>{let t=JSON.parse(e?.data?.setupIntent?.session);Z.redirectToCardSaving(t.id,t.url)}))},M=()=>{I.go(-1)};return f.hK.addListener(f.YT.Completed,(()=>{})),f.hK.addListener(f.YT.Failed,(()=>{U.value="Something went wrong, please try again"})),f.hK.addListener(f.uA.Completed,(()=>{})),f.hK.addListener(f.uA.Failed,(()=>{U.value="Something went wrong, please try again"})),(e,t)=>((0,n.wg)(),(0,n.j4)(d.Z,{"full-width-footer":!1},{header:(0,n.w5)((()=>[(0,n.Wm)(r.Z,{"back-btn":"",onBack:M,title:"Payment"})])),content:(0,n.w5)((()=>[(0,s.SU)(H)?((0,n.wg)(),(0,n.j4)((0,s.SU)(c.PQ),{key:0,class:"spinner",name:"lines"})):((0,n.wg)(),(0,n.iD)(n.HY,{key:1},[a.value?((0,n.wg)(),(0,n.j4)(i.Z,{key:0})):((0,n.wg)(),(0,n.iD)("div",S,[(0,n.Wm)((0,s.SU)(c.wd),{class:"cards__title"},{default:(0,n.w5)((()=>[(0,n.Uk)("Payment Method")])),_:1}),g.value?.length?((0,n.wg)(),(0,n.iD)("div",C,[(0,n.Wm)(u.Z,{"show-start":"",items:g.value,"slides-offset-after":16,"slides-offset-before":16},{start:(0,n.w5)((()=>[(0,n.Wm)((0,s.SU)(c.YG),{onClick:B,class:"add-card"},{default:(0,n.w5)((()=>[(0,n.Wm)((0,s.SU)(c.gu),{src:"assets/icon/payment/plus.svg",class:"add-icon"})])),_:1})])),default:(0,n.w5)((e=>[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(e,(e=>((0,n.wg)(),(0,n.j4)(o.Z,{key:e.id,"card-holder":e.card_holder,"card-number":e.pm_last_four,"exp-date":e.exp_month+"/"+e.exp_year,"is-default":e.is_default,class:"card-slide",onClick:t=>N(e.id)},null,8,["card-holder","card-number","exp-date","is-default","onClick"])))),128))])),_:1},8,["items"])])):((0,n.wg)(),(0,n.j4)(m.Z,{key:1,class:"add-card-btn",onClick:B}))]))],64))])),footer:(0,n.w5)((()=>[(0,n.Wm)((0,s.SU)(c.YG),{onClick:x,class:"submit-btn",disabled:g.value.length<1},{default:(0,n.w5)((()=>[(0,n.Uk)((0,l.zw)(g.value.length<1?"Create card":"Confirm"),1)])),_:1},8,["disabled"])])),_:1}))}});const I=U;var P=I}}]);
//# sourceMappingURL=663.d52ce55f.js.map