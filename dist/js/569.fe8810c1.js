"use strict";(self["webpackChunkspotter"]=self["webpackChunkspotter"]||[]).push([[569],{97439:function(e,a,t){var s,n,r;t.d(a,{GW:function(){return n},dk:function(){return r},oK:function(){return s}}),function(e){e["Prompt"]="PROMPT",e["Camera"]="CAMERA",e["Photos"]="PHOTOS"}(s||(s={})),function(e){e["Rear"]="REAR",e["Front"]="FRONT"}(n||(n={})),function(e){e["Uri"]="uri",e["Base64"]="base64",e["DataUrl"]="dataUrl"}(r||(r={}))},96826:function(e,a,t){t.d(a,{V1:function(){return r},dk:function(){return n.dk},oK:function(){return n.oK}});var s=t(29895),n=t(97439);const r=(0,s.fo)("Camera",{web:()=>t.e(6806).then(t.bind(t,66806)).then((e=>new e.CameraWeb))})},29729:function(e,a,t){t.d(a,{Av:function(){return p},Ch:function(){return g},pt:function(){return u},xu:function(){return m}});t(57658);var s=t(87794),n=t(23165),r=t(27484),o=t.n(r),i=t(25934);const{first_name:c,last_name:l}=JSON.parse(localStorage.getItem("user")||"{}"),d=(e,a)=>{if(e.type!==s.gK.OperationRequired&&!e?.operation_data?.visibleFor?.length||e.type!==s.gK.OperationRequired&&e?.operation_data?.visibleFor?.length&&e?.operation_data?.visibleFor.find((e=>Number(e)===Number(a))))return e},u=(e,a)=>{const t=d(e.message,a);return{roomId:e?.id.toString(),roomName:e.participant.chat_name,avatar:e.participant.avatar?e.participant.avatar:"",users:e.participants,status:t?.type,lastMessage:t?.message,type:n.n.Chat,userId:a,participantId:e.participants.find((e=>Number(e.user_id)!==Number(a)))?.user_id,locked:e.locked,symbols:`${e.participant.chat_name.split(" ")[0].charAt(0)} ${e.participant.chat_name.split(" ")[1].charAt(0)}`,unread:e.unread[a]}},m=(e,a)=>Object.values(e).reduce(((e,t)=>(e.push({avatar:t.participants.filter((e=>Number(e.user_id)===Number(a)))[0]?.avatar,status:t.type,roomId:t.id.toString(),roomName:t.sender_name,lastMessage:{time:t?.operation_data?.time,address:t?.operation_data?.address},type:n.n.Chat,id:t.id,trainingId:t?.operation_data?.training_id,participantId:t.participants.find((e=>Number(e.user_id)!==Number(a)))?.user_id,key:(0,i.Z)()}),e)),[]),p=e=>[{content:e?.message,username:e.sender_name,date:o()(e.created_at).format("D MMM YYYY"),timestamp:o()(e.created_at).format("hh:mm a"),type:e.type,id:e.id,trainingId:e?.operation_data?.training_id}],g=(e,a)=>Object.values(e?.messages).reduce(((e,t)=>(d(t,a)&&e.push({...t,parentId:t?.parent_id,content:t?.message,username:t.sender_name,date:o()(t.created_at).format("D MMM YYYY"),timestamp:o()(t.created_at).format("hh:mm a"),type:t.type,id:t.id,isCurUserMessage:t.sender_name===`${c} ${l}`&&(t.type===s.gK.Message||t.type===s.gK.Attachment),trainingId:t?.operation_data?.training_id,key:(0,i.Z)()}),e)),[])},23165:function(e,a,t){var s,n;t.d(a,{n:function(){return n}}),function(e){e["SystemPending"]="SYSTEM_PENDING",e["SystemApproved"]="SYSTEM_APPROVED",e["SystemRejected"]="SYSTEM_REJECTED",e["Default"]="DEFAULT"}(s||(s={})),function(e){e["Chat"]="CHAT",e["Request"]="REQUEST"}(n||(n={}))},27705:function(e,a,t){t.d(a,{Z:function(){return u}});var s=t(66252),n=t(2262),r=t(3577),o=t(31810);const i=["src"],c={key:2,class:"avatar__online-indicator"};var l=(0,s.aZ)({__name:"Avatar",props:{src:{},symbols:{},isOnline:{type:Boolean},square:{type:Boolean}},setup(e){return(e,a)=>((0,s.wg)(),(0,s.j4)((0,n.SU)(o.Bs),{slot:"start",class:"avatar"},{default:(0,s.w5)((()=>[e.src?((0,s.wg)(),(0,s.iD)("img",{key:0,src:e.src,class:(0,r.C_)(["avatar__image",{"avatar__image--online":e.isOnline,"avatar__image--square":e.square}])},null,10,i)):((0,s.wg)(),(0,s.iD)(s.HY,{key:1},[(0,s.Uk)((0,r.zw)(e.symbols),1)],64)),e.isOnline?((0,s.wg)(),(0,s.iD)("div",c)):(0,s.kq)("",!0)])),_:1}))}});const d=l;var u=d},60569:function(e,a,t){t.r(a),t.d(a,{default:function(){return G}});t(57658);var s=t(66252),n=t(10121),r=t(3577),o=t(2262),i=t(31810),c=t(49316),l=t(87794),d=t(22201),u=t(61081),m=t(23165);const p=e=>((0,s.dD)("data-v-f26e3bc8"),e=e(),(0,s.Cn)(),e),g={key:0,class:"message__date"},_={class:"message__container"},v=["src"],y={class:"message__content-main"},b={key:0,class:"system-icon__container"},f={key:0,class:"message__content-additional"},h=p((()=>(0,s._)("br",null,null,-1))),w={class:"message__timestamp"},k={key:1,class:"approve-form__buttons"};var U=(0,s.aZ)({__name:"Message",props:{contentType:{default:l.gK.Message},content:{},timestamp:{},date:{},currentUser:{type:Boolean},showDate:{type:Boolean},approvable:{type:Boolean},trainingId:{default:null},messageId:{},deleteable:{type:Boolean}},emits:["delete-message"],setup(e,{emit:a}){const t=e,n=(0,o.iH)({NODE_ENV:"production",BASE_URL:"/"}.VUE_APP_FB_STORAGE),p=(0,d.tv)(),U=(0,s.Fl)((()=>[l.gK.Cancel,l.gK.Info,l.gK.Confirm].includes(t.contentType))),{mutate:C,loading:S}=(0,c.Db)(l.RO),O=()=>{a("delete-message",t.messageId)},D=async()=>{if(t.deleteable){const e=await i.Cl.create({header:t.content,buttons:[{text:"Cancel",role:"cancel"},{text:"Delete",role:"confirm",handler:()=>{O()}}]});await e.present()}},N=({graphQLErrors:e})=>{if(e.length){const a=e[0];if(a?.debugMessage)return a?.debugMessage;if(a?.extensions?.validation)return a?.extensions?.validation["input.state"][0]}return"Something went wrong. Please try again."},M=()=>{C({input:{id:t.trainingId,state:l.Z3.Accepted}}).then((async()=>{const e=await i.Mn.create({message:"Order successfully approved",duration:2e3,icon:"assets/icon/success.svg",cssClass:"success-toast"});e.present(),p.push({name:u.N.ChatList,query:{type:m.n.Request.toLocaleLowerCase()}})})).catch((async e=>{const a=N(e),t=await i.Mn.create({message:a,duration:2e3,icon:"assets/icon/info.svg",cssClass:"danger-toast"});t.present()}))},A=()=>{C({input:{id:t.trainingId,state:l.Z3.Rejected}}).then((async()=>{const e=await i.Mn.create({message:"Order successfully declined",duration:2e3,icon:"assets/icon/success.svg",cssClass:"success-toast"});e.present(),p.push({name:u.N.ChatList,query:{type:m.n.Request.toLocaleLowerCase()}})})).catch((async e=>{const a=N(e),t=await i.Mn.create({message:a,duration:5e3,icon:"assets/icon/info.svg",cssClass:"danger-toast"});t.present()}))};return(e,a)=>{const t=(0,s.Q2)("touch");return(0,s.wg)(),(0,s.iD)("div",{class:(0,r.C_)([{"message__row--current-user":e.currentUser},"message__row"])},[e.showDate?((0,s.wg)(),(0,s.iD)("div",g,(0,r.zw)(e.date),1)):(0,s.kq)("",!0),(0,s._)("div",_,[e.contentType===(0,o.SU)(l.gK).Attachment?((0,s.wg)(),(0,s.iD)("img",{key:0,src:`${n.value}/${e.content}`,class:(0,r.C_)([{"message__img--current-user":e.currentUser},"message__img"])},null,10,v)):(0,s.wy)(((0,s.wg)(),(0,s.iD)("div",{key:1,class:(0,r.C_)([{"message__content--approved":e.contentType===(0,o.SU)(l.gK).Confirm,"message__content--pending":e.contentType===(0,o.SU)(l.gK).Info,"message__content--rejected":e.contentType===(0,o.SU)(l.gK).Cancel,"message__content--current-user":e.currentUser,"message__content--approvable":e.approvable},"message__content"])},[(0,s._)("div",y,[U.value?((0,s.wg)(),(0,s.iD)("div",b,[(0,s.Wm)((0,o.SU)(i.gu),{src:`assets/icon/chat/${e.contentType}.svg`,class:"system-icon"},null,8,["src"])])):(0,s.kq)("",!0),(0,s.Uk)(" "+(0,r.zw)(e.content),1)]),(0,s.Wm)((0,o.SU)(i.d8),{trigger:"click-trigger","trigger-action":"click"},{default:(0,s.w5)((()=>[(0,s.Wm)((0,o.SU)(i.W2),{class:"ion-padding"},{default:(0,s.w5)((()=>[(0,s.Uk)("Delete")])),_:1})])),_:1}),e.contentType===(0,o.SU)(l.gK).Info&&e.approvable?((0,s.wg)(),(0,s.iD)("div",f,[(0,s.Wm)((0,o.SU)(i.yW),{class:"message__content-additional--primary",color:"primary"},{default:(0,s.w5)((()=>[(0,s.Uk)("You have to approve or decline the order. Client is waiting... ")])),_:1}),h,(0,s.Wm)((0,o.SU)(i.yW),{class:"message__content-additional--light",color:"light"},{default:(0,s.w5)((()=>[(0,s.Wm)((0,o.SU)(i.gu),{class:"system-icon",src:"assets/icon/info.svg"}),(0,s.Uk)(" You have 2 hours to approve or decline session ")])),_:1}),(0,s.Wm)((0,o.SU)(i.X7),{value:.8,class:"approve-progress",color:"light"})])):(0,s.kq)("",!0)],2)),[[t,D,"hold"]]),(0,s._)("div",w,(0,r.zw)(e.timestamp),1)]),e.approvable?((0,s.wg)(),(0,s.iD)("div",k,[(0,s.Wm)((0,o.SU)(i.YG),{class:"approve-form__button",onClick:M,disabled:(0,o.SU)(S)},{default:(0,s.w5)((()=>[(0,o.SU)(S)?((0,s.wg)(),(0,s.j4)((0,o.SU)(i.PQ),{key:1,name:"lines"})):((0,s.wg)(),(0,s.iD)(s.HY,{key:0},[(0,s.Uk)("Approve order")],64))])),_:1},8,["disabled"]),(0,s.Wm)((0,o.SU)(i.YG),{class:"approve-form__button secondary",onClick:A,disabled:(0,o.SU)(S)},{default:(0,s.w5)((()=>[(0,o.SU)(S)?((0,s.wg)(),(0,s.j4)((0,o.SU)(i.PQ),{key:1,name:"lines"})):((0,s.wg)(),(0,s.iD)(s.HY,{key:0},[(0,s.Uk)("Decline order")],64))])),_:1},8,["disabled"])])):(0,s.kq)("",!0)],2)}}}),C=t(83744);const S=(0,C.Z)(U,[["__scopeId","data-v-f26e3bc8"]]);var O=S,D=t(27705);const N={class:"header__title"},M={class:"header__text"};var A=(0,s.aZ)({__name:"RoomHeader",props:{avatarSrc:{},isOnline:{type:Boolean},backBtn:{type:Boolean,default:!1},title:{default:null}},emits:["back"],setup(e,{emit:a}){const t=e,n=(0,s.Fl)((()=>`${t.title?.split(" ")[0]?.charAt(0)} ${t.title?.split(" ")[1]?.charAt(0)}`));return(e,t)=>((0,s.wg)(),(0,s.j4)((0,o.SU)(i.sr),{class:"header"},{default:(0,s.w5)((()=>[(0,s.Wm)((0,o.SU)(i.Sm),{slot:"start"},{default:(0,s.w5)((()=>[e.backBtn?((0,s.wg)(),(0,s.j4)((0,o.SU)(i.YG),{key:0,class:"back-btn",onClick:t[0]||(t[0]=e=>a("back"))},{default:(0,s.w5)((()=>[(0,s.Wm)((0,o.SU)(i.gu),{src:"assets/icon/arrow-back.svg"})])),_:1})):(0,s.kq)("",!0)])),_:1}),(0,s._)("div",N,[(0,s.Wm)(D.Z,{src:e.avatarSrc,class:"avatar",symbols:n.value},null,8,["src","symbols"]),(0,s._)("div",M,[(0,s.Wm)((0,o.SU)(i.wd),{class:"header__title-room"},{default:(0,s.w5)((()=>[(0,s.Uk)((0,r.zw)(e.title),1)])),_:1}),(0,s.Wm)((0,o.SU)(i.yW),{class:(0,r.C_)([{"header__title-status--offline":!e.isOnline},"header__title-status"])},{default:(0,s.w5)((()=>[(0,s.Uk)((0,r.zw)(e.isOnline?"Online":"Offline"),1)])),_:1},8,["class"])])])])),_:1}))}});const P=(0,C.Z)(A,[["__scopeId","data-v-9abe11f4"]]);var K,j=P,E=t(45241),I=t(96826);(function(e){e["Delete"]="DELETE",e["MakeAPhoto"]="MAKE_A_PHOTO",e["PhotoLibrary"]="PHOTO_LIBRARY"})(K||(K={}));const T=e=>{const a=async a=>{const s=await i.BO.create({mode:"ios",buttons:[...a?.value?[{text:"Delete photo",role:"destructive",data:{type:K.Delete}}]:[],{text:"Make a photo",data:{type:K.MakeAPhoto}},{text:"Photo library",data:{type:K.PhotoLibrary}},{text:"Cancel",role:"cancel"}]});await s.present();const{data:n}=await s.onWillDismiss(),r=n.type,o={[K.Delete]:()=>e(),[K.MakeAPhoto]:()=>t(I.oK.Camera),[K.PhotoLibrary]:()=>t(I.oK.Photos)};o[r]&&o[r]()},t=async a=>{if((0,E.a)("capacitor")){const e=await I.V1.requestPermissions();if(a===I.oK.Camera&&"denied"===e.camera||a===I.oK.Photos&&"denied"===e.photos){const e=await i.Cl.create({header:"Permissions denied",message:a===I.oK.Camera?"You have denied the app from using the camera":"You have denied the app access to your photos",buttons:["OK"]});return void await e.present()}}const t=await I.V1.getPhoto({width:264,height:264,quality:90,allowEditing:!0,resultType:I.dk.Base64,source:a});e(`data:image/jpeg;base64,${t.base64String}`)};return{getPhoto:t,openLoadOptions:a}};var q=t(16025),R=t(74444);const W={class:"room-footer"};var Y=(0,s.aZ)({__name:"RoomFooter",props:{disabled:{type:Boolean}},emits:["send"],setup(e,{emit:a}){const t=e,n=(0,o.iH)(""),c=e=>{const t=(0,q.U)(e,(0,R.k$)());a("send",t,l.gK.Attachment)},{openLoadOptions:d}=T(c),u=()=>{t.disabled||d()},m=()=>{n.value&&!t.disabled&&(a("send",n.value,l.gK.Message),n.value="")};return(e,a)=>((0,s.wg)(),(0,s.iD)("div",W,[(0,s._)("div",{class:(0,r.C_)([{"room__footer__input--disabled":e.disabled},"room-footer__input"])},[(0,s.Wm)((0,o.SU)(i.gu),{onClick:u,src:"assets/icon/clip.svg",class:(0,r.C_)([{"file-input--disabled":e.disabled},"file-input"])},null,8,["class"]),(0,s.Wm)((0,o.SU)(i.g2),{rows:1,"auto-grow":!0,modelValue:n.value,"onUpdate:modelValue":a[0]||(a[0]=e=>n.value=e),disabled:e.disabled,placeholder:"Type message",class:"room-footer__textarea"},null,8,["modelValue","disabled"]),n.value?((0,s.wg)(),(0,s.j4)((0,o.SU)(i.yW),{key:0,onClick:m,class:"send-message__button"},{default:(0,s.w5)((()=>[(0,s.Uk)(" Send ")])),_:1})):(0,s.kq)("",!0)],2)]))}});const B=(0,C.Z)(Y,[["__scopeId","data-v-417f38ec"]]);var L=B,Z=t(12712),H=t(29729),x=t(98938),F=t(89355),$=t(43173),V=(0,s.aZ)({__name:"Personal",setup(e){const a=(0,d.yj)(),t=(0,d.tv)(),{role:r}=(0,Z.Z)(),{id:i}=(0,$.Z)(),p=(0,o.iH)([]),g=(0,o.iH)(null),_=(0,o.iH)(null),v=(0,o.qj)({chats:[],messages:[]});(0,d.iS)(((e,a,t)=>{e.name===u.N.ConfirmOrder?t({name:u.N.Dashboard}):t()}));const y=async()=>{const e=a.query.type===m.n.Request.toLocaleLowerCase()?x.x5:x.AZ;await(0,F.jM)(e,(e=>{e.forEach((e=>{if(a.query.type===m.n.Request.toLocaleLowerCase()&&e.key===i&&a.params.id){const t=Object.values(e.val()).filter((e=>Number(e.id)===Number(a.params.id))).length?Object.values(e.val()).filter((e=>Number(e.id)===Number(a.params.id)))[0]:{};v.chats={avatar:t?.participants?.filter((e=>Number(e.user_id)===Number(i)))[0]?.avatar,roomName:t.sender_name,participantId:t.participants.find((e=>Number(e.user_id)!==Number(i)))?.user_id};const s=(0,H.Av)([t][0]);v.messages.push(...s)}else{const t=e.val();t.id==a.params.id&&(t.participants.forEach((async e=>{if(Number(e.user_id)===Number(i)){const e={...t,message:Object.values(t.messages).pop(),participant:t.participants.filter((e=>Number(e.user_id)===Number(i)))[0]};v.chats=(0,H.pt)(e,i)}})),v.messages=Object.assign({},(0,H.Ch)(t,i)),(!v.messages[Object.keys(v.messages)?.pop()]?.read||v.messages[Object.keys(v.messages)?.pop()]&&v.messages[Object.keys(v.messages)?.pop()]?.read?.length&&v.messages[Object.keys(v.messages)?.pop()].read[0]&&v.messages[Object.keys(v.messages)?.pop()].read[0]!==Number(i))&&C({id:v.messages[Object.keys(v.messages)?.pop()].id}))}}))}))},b=()=>{(0,F.jM)(x.AJ,(e=>{e.forEach((e=>{p.value=[...p.value,e.val()]}))}))},f=e=>!!p.value.find((a=>a===e));(0,s.wF)((()=>{b(),y(),_?.value?.scrollToBottom()}));const h=e=>{const a=v.messages[e],t=v.messages[e-1];return a.date!==t?.date},w=(e,a)=>r===l.g8.Trainer&&e===l.gK.OperationRequired&&(v.messages[Number(a)+1]&&v.messages[Number(a)+1]?.type!==l.gK.Cancel&&v.messages[Number(a)+1]?.type!==l.gK.Confirm||!v.messages[Number(a)+1]),{mutate:k}=(0,c.Db)(l._),{mutate:U}=(0,c.Db)(l.Uh),{mutate:C}=(0,c.Db)(l.qv),S=(e,t)=>{const s=t.toLowerCase();k({chat_id:a.params.id,input:{type:t,[s]:e}}),g.value&&_?.value?.scrollToBottom()},D=e=>{U({id:e})},N=()=>{t.go(-1)};return(e,a)=>((0,s.wg)(),(0,s.j4)(n.Z,{ref_key:"layout",ref:_},{header:(0,s.w5)((()=>[(0,s.Wm)(j,{"back-btn":"","is-online":f(v.chats?.participantId),title:v.chats?.roomName||"","avatar-src":v.chats?.avatar||"",onBack:N},null,8,["is-online","title","avatar-src"])])),content:(0,s.w5)((()=>[(0,s._)("div",{ref_key:"messagesContainer",ref:g,class:"messages__container"},[(0,s._)("div",null,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(v.messages,((e,a)=>((0,s.wg)(),(0,s.j4)(O,{key:e.id,content:e.content,timestamp:e.timestamp,date:e.date,"content-type":e.type,"current-user":e.isCurUserMessage,"show-date":h(a),approvable:w(e.type,a),"training-id":e?.trainingId,onDeleteMessage:D,"message-id":e.id,deleteable:e.isCurUserMessage},null,8,["content","timestamp","date","content-type","current-user","show-date","approvable","training-id","message-id","deleteable"])))),128))])],512)])),footer:(0,s.w5)((()=>[(0,s.Wm)(L,{onSend:S,disabled:v.chats?.locked},null,8,["disabled"])])),_:1},512))}});const z=(0,C.Z)(V,[["__scopeId","data-v-7dd9da5c"]]);var G=z}}]);
//# sourceMappingURL=569.fe8810c1.js.map