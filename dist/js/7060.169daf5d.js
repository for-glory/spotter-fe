"use strict";(self["webpackChunkspotter"]=self["webpackChunkspotter"]||[]).push([[7060],{17060:function(e,t,n){n.r(t),n.d(t,{GoogleAuthWeb:function(){return i}});var s=n(29895);class i extends s.Uw{constructor(){super()}loadScript(){if("undefined"===typeof document)return;const e="gapi",t=null===document||void 0===document?void 0:document.getElementById(e);if(t)return;const n=document.getElementsByTagName("head")[0],s=document.createElement("script");s.type="text/javascript",s.defer=!0,s.async=!0,s.id=e,s.onload=this.platformJsLoaded.bind(this),s.src="https://apis.google.com/js/platform.js",n.appendChild(s)}initialize(e={clientId:"",scopes:[],grantOfflineAccess:!1}){var t,n;if("undefined"===typeof window)return;const s=null===(t=document.getElementsByName("google-signin-client_id")[0])||void 0===t?void 0:t.content,i=e.clientId||s||"";i||console.warn("GoogleAuthPlugin - clientId is empty"),this.options={clientId:i,grantOfflineAccess:null!==(n=e.grantOfflineAccess)&&void 0!==n&&n,scopes:e.scopes||[]},this.gapiLoaded=new Promise((e=>{window.gapiResolve=e,this.loadScript()})),this.addUserChangeListener()}platformJsLoaded(){gapi.load("auth2",(()=>{const e={client_id:this.options.clientId,plugin_name:"CodetrixStudioCapacitorGoogleAuth"};this.options.scopes.length&&(e.scope=this.options.scopes.join(" ")),gapi.auth2.init(e),window.gapiResolve()}))}async signIn(){return new Promise((async(e,t)=>{var n;try{let t;const s=null!==(n=this.options.grantOfflineAccess)&&void 0!==n&&n;if(s){const e=await gapi.auth2.getAuthInstance().grantOfflineAccess();t=e.code}else await gapi.auth2.getAuthInstance().signIn();const i=gapi.auth2.getAuthInstance().currentUser.get();s&&await i.reloadAuthResponse();const o=this.getUserFrom(i);o.serverAuthCode=t,e(o)}catch(s){t(s)}}))}async refresh(){const e=await gapi.auth2.getAuthInstance().currentUser.get().reloadAuthResponse();return{accessToken:e.access_token,idToken:e.id_token,refreshToken:""}}async signOut(){return gapi.auth2.getAuthInstance().signOut()}async addUserChangeListener(){await this.gapiLoaded,gapi.auth2.getAuthInstance().currentUser.listen((e=>{this.notifyListeners("userChange",e.isSignedIn()?this.getUserFrom(e):null)}))}getUserFrom(e){const t={},n=e.getBasicProfile();t.email=n.getEmail(),t.familyName=n.getFamilyName(),t.givenName=n.getGivenName(),t.id=n.getId(),t.imageUrl=n.getImageUrl(),t.name=n.getName();const s=e.getAuthResponse(!0);return t.authentication={accessToken:s.access_token,idToken:s.id_token,refreshToken:""},t}}}}]);
//# sourceMappingURL=7060.169daf5d.js.map