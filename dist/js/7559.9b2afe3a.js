"use strict";(self["webpackChunkspotter"]=self["webpackChunkspotter"]||[]).push([[7559],{29729:function(e,a,t){t.d(a,{Av:function(){return p},Ch:function(){return _},pt:function(){return m},xu:function(){return d}});t(57658);var s=t(87794),n=t(23165),i=t(27484),r=t.n(i),o=t(25934);const{first_name:l,last_name:u}=JSON.parse(localStorage.getItem("user")||"{}"),c=(e,a)=>{if(e.type!==s.gK.OperationRequired&&!e?.operation_data?.visibleFor?.length||e.type!==s.gK.OperationRequired&&e?.operation_data?.visibleFor?.length&&e?.operation_data?.visibleFor.find((e=>Number(e)===Number(a))))return e},m=(e,a)=>{const t=c(e.message,a);return{roomId:e?.id.toString(),roomName:e.participant.chat_name,avatar:e.participant.avatar?e.participant.avatar:"",users:e.participants,status:t?.type,lastMessage:t?.message,type:n.n.Chat,userId:a,participantId:e.participants.find((e=>Number(e.user_id)!==Number(a)))?.user_id,locked:e.locked,symbols:`${e.participant.chat_name.split(" ")[0].charAt(0)} ${e.participant.chat_name.split(" ")[1].charAt(0)}`,unread:e.unread[a]}},d=(e,a)=>Object.values(e).reduce(((e,t)=>(e.push({avatar:t.participants.filter((e=>Number(e.user_id)===Number(a)))[0]?.avatar,status:t.type,roomId:t.id.toString(),roomName:t.sender_name,lastMessage:{time:t?.operation_data?.time,address:t?.operation_data?.address},type:n.n.Chat,id:t.id,trainingId:t?.operation_data?.training_id,participantId:t.participants.find((e=>Number(e.user_id)!==Number(a)))?.user_id,key:(0,o.Z)()}),e)),[]),p=e=>[{content:e?.message,username:e.sender_name,date:r()(e.created_at).format("D MMM YYYY"),timestamp:r()(e.created_at).format("hh:mm a"),type:e.type,id:e.id,trainingId:e?.operation_data?.training_id}],_=(e,a)=>Object.values(e?.messages).reduce(((e,t)=>(c(t,a)&&e.push({...t,parentId:t?.parent_id,content:t?.message,username:t.sender_name,date:r()(t.created_at).format("D MMM YYYY"),timestamp:r()(t.created_at).format("hh:mm a"),type:t.type,id:t.id,isCurUserMessage:t.sender_name===`${l} ${u}`&&(t.type===s.gK.Message||t.type===s.gK.Attachment),trainingId:t?.operation_data?.training_id,key:(0,o.Z)()}),e)),[])},23165:function(e,a,t){var s,n;t.d(a,{n:function(){return n}}),function(e){e["SystemPending"]="SYSTEM_PENDING",e["SystemApproved"]="SYSTEM_APPROVED",e["SystemRejected"]="SYSTEM_REJECTED",e["Default"]="DEFAULT"}(s||(s={})),function(e){e["Chat"]="CHAT",e["Request"]="REQUEST"}(n||(n={}))},25934:function(e,a,t){var s;t.d(a,{Z:function(){return _}});var n=new Uint8Array(16);function i(){if(!s&&(s="undefined"!==typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!==typeof msCrypto&&"function"===typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto),!s))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return s(n)}var r=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function o(e){return"string"===typeof e&&r.test(e)}for(var l=o,u=[],c=0;c<256;++c)u.push((c+256).toString(16).substr(1));function m(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,t=(u[e[a+0]]+u[e[a+1]]+u[e[a+2]]+u[e[a+3]]+"-"+u[e[a+4]]+u[e[a+5]]+"-"+u[e[a+6]]+u[e[a+7]]+"-"+u[e[a+8]]+u[e[a+9]]+"-"+u[e[a+10]]+u[e[a+11]]+u[e[a+12]]+u[e[a+13]]+u[e[a+14]]+u[e[a+15]]).toLowerCase();if(!l(t))throw TypeError("Stringified UUID is invalid");return t}var d=m;function p(e,a,t){e=e||{};var s=e.random||(e.rng||i)();if(s[6]=15&s[6]|64,s[8]=63&s[8]|128,a){t=t||0;for(var n=0;n<16;++n)a[t+n]=s[n];return a}return d(s)}var _=p},54354:function(e,a,t){t.d(a,{Z:function(){return c}});var s=t(66252),n=t(2262),i=t(3577),r=t(31810),o=(0,s.aZ)({__name:"PageTabs",props:{tabs:{},value:{}},emits:["change"],setup(e,{emit:a}){const t=e=>{e.detail.value&&a("change",e.detail.value)};return(e,a)=>((0,s.wg)(),(0,s.iD)("div",null,[(0,s.Wm)((0,n.SU)(r.cJ),{id:"page-tabs",mode:"ios",class:"tabs",onIonChange:a[0]||(a[0]=e=>t(e)),value:e.value||e.tabs&&e.tabs[0].name},{default:(0,s.w5)((()=>[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.tabs,(e=>((0,s.wg)(),(0,s.j4)((0,n.SU)(r.GO),{key:e.name,value:e.name,class:"tabs__item",disabled:e.disabled},{default:(0,s.w5)((()=>[(0,s.Uk)((0,i.zw)(e.label),1)])),_:2},1032,["value","disabled"])))),128))])),_:1},8,["value"])]))}}),l=t(83744);const u=(0,l.Z)(o,[["__scopeId","data-v-6ea469ae"]]);var c=u},27705:function(e,a,t){t.d(a,{Z:function(){return m}});var s=t(66252),n=t(2262),i=t(3577),r=t(31810);const o=["src"],l={key:2,class:"avatar__online-indicator"};var u=(0,s.aZ)({__name:"Avatar",props:{src:{},symbols:{},isOnline:{type:Boolean},square:{type:Boolean}},setup(e){return(e,a)=>((0,s.wg)(),(0,s.j4)((0,n.SU)(r.Bs),{slot:"start",class:"avatar"},{default:(0,s.w5)((()=>[e.src?((0,s.wg)(),(0,s.iD)("img",{key:0,src:e.src,class:(0,i.C_)(["avatar__image",{"avatar__image--online":e.isOnline,"avatar__image--square":e.square}])},null,10,o)):((0,s.wg)(),(0,s.iD)(s.HY,{key:1},[(0,s.Uk)((0,i.zw)(e.symbols),1)],64)),e.isOnline?((0,s.wg)(),(0,s.iD)("div",l)):(0,s.kq)("",!0)])),_:1}))}});const c=u;var m=c},7559:function(e,a,t){t.r(a),t.d(a,{default:function(){return A}});t(57658);var s=t(66252),n=t(2262),i=t(49963),r=t(10121),o=t(19239),l=t(3577),u=t(31810),c=t(27705),m=t(23165);const d={class:"user-item__inner"},p={class:"user-item__head"},_={key:1,class:"user-item__last-message--highlighted"},g={class:"last-msg-wrap"},v={class:"last-msg-wrap"},y={key:0,class:"separator"};var h=(0,s.aZ)({__name:"Room",props:{roomName:{},avatarUrl:{},roomId:{},lastMessage:{},isOnline:{type:Boolean},time:{},type:{},symbols:{},unread:{}},emits:["open","delete","approve"],setup(e){return(e,a)=>((0,s.wg)(),(0,s.j4)((0,n.SU)(u.td),null,{default:(0,s.w5)((()=>[(0,s.Wm)((0,n.SU)(u.Ie),{onClick:a[0]||(a[0]=a=>e.$emit("open")),side:"end",lines:"none",class:"user-item"},{default:(0,s.w5)((()=>[(0,s.Wm)(c.Z,{class:"user-item__avatar","is-online":e.isOnline,src:e.avatarUrl,symbols:e.symbols},null,8,["is-online","src","symbols"]),(0,s._)("div",d,[(0,s._)("div",null,[(0,s._)("div",p,[(0,s.Wm)((0,n.SU)(u.Q$),{class:"user-item__title"},{default:(0,s.w5)((()=>[(0,s.Uk)((0,l.zw)(e.roomName),1)])),_:1}),(0,s.Wm)((0,n.SU)(u.yW),{class:"user-item__time"},{default:(0,s.w5)((()=>[(0,s.Uk)((0,l.zw)(e.time),1)])),_:1})]),e.lastMessage&&"string"===typeof e.lastMessage?((0,s.wg)(),(0,s.iD)("div",{key:0,class:(0,l.C_)([{"user-item__last-message--highlighted":e.type===(0,n.SU)(m.n).Request},"user-item__last-message"])},(0,l.zw)(e.lastMessage),3)):e.lastMessage?((0,s.wg)(),(0,s.iD)("div",_,[(0,s._)("div",g,[(0,s.Wm)((0,n.SU)(u.gu),{class:"address-icon",src:"assets/icon/location.svg"}),(0,s.Wm)((0,n.SU)(u.yW),{class:"user-item__last-message"},{default:(0,s.w5)((()=>[(0,s.Uk)((0,l.zw)(e.lastMessage?.address||"Training at client's location"),1)])),_:1})]),(0,s._)("div",v,[(0,s.Wm)((0,n.SU)(u.gu),{class:"time-icon",src:"assets/icon/time.svg"}),(0,s.Wm)((0,n.SU)(u.yW),{class:"user-item__last-message"},{default:(0,s.w5)((()=>[(0,s.Uk)((0,l.zw)(e.lastMessage?.time),1)])),_:1})])])):(0,s.kq)("",!0)]),(0,s._)("div",null,[e.unread?((0,s.wg)(),(0,s.j4)((0,n.SU)(u.yW),{key:0,class:"user-item__unread"},{default:(0,s.w5)((()=>[(0,s.Uk)((0,l.zw)(e.unread),1)])),_:1})):(0,s.kq)("",!0)])])])),_:1}),(0,s.Wm)((0,n.SU)(u.IK),{class:"options"},{default:(0,s.w5)((()=>[(0,s.Wm)((0,n.SU)(u.u8),{"icon-only":"",class:(0,l.C_)([{"option--first":e.type===(0,n.SU)(m.n).Request},"option"]),onClick:a[1]||(a[1]=a=>e.$emit("delete"))},{default:(0,s.w5)((()=>[(0,s.Wm)((0,n.SU)(u.gu),{class:"option__icon",src:"assets/icon/delete.svg"})])),_:1},8,["class"]),e.type===(0,n.SU)(m.n).Request?((0,s.wg)(),(0,s.iD)("div",y)):(0,s.kq)("",!0),e.type===(0,n.SU)(m.n).Request?((0,s.wg)(),(0,s.j4)((0,n.SU)(u.u8),{key:1,"icon-only":"",class:"option",onClick:a[2]||(a[2]=a=>e.$emit("approve"))},{default:(0,s.w5)((()=>[(0,s.Wm)((0,n.SU)(u.gu),{color:"light",class:"option__icon option__icon-approve",src:"assets/icon/success.svg"})])),_:1})):(0,s.kq)("",!0)])),_:1})])),_:1}))}}),f=t(83744);const w=(0,f.Z)(h,[["__scopeId","data-v-65a451be"]]);var b=w,k=t(22201),U=t(87794),S=t(61081);const q={class:"list-empty"};var C=(0,s.aZ)({__name:"ListEmpty",props:{title:{default:"chats"},chats:{type:Boolean}},setup(e){const a=(0,k.tv)(),t=()=>{a.push({name:S.N.Trainers})};return(e,a)=>((0,s.wg)(),(0,s.iD)("div",q,[(0,s.Wm)((0,n.SU)(u.gu),{src:"assets/icon/chat-empty.svg",class:"list-empty__icon"}),(0,s.Wm)((0,n.SU)(u.wd),{class:"list-empty__title"},{default:(0,s.w5)((()=>[(0,s.Uk)("No "+(0,l.zw)(e.title)+" here",1)])),_:1}),e.chats?((0,s.wg)(),(0,s.j4)((0,n.SU)(u.yW),{key:0,class:"list-empty__description"},{default:(0,s.w5)((()=>[(0,s.Uk)(" You haven't chatted with anyone yet ")])),_:1})):(0,s.kq)("",!0),e.chats?((0,s.wg)(),(0,s.j4)((0,n.SU)(u.YG),{key:1,class:"list-empty__button",onClick:t},{default:(0,s.w5)((()=>[(0,s.Uk)(" Find trainer ")])),_:1})):(0,s.kq)("",!0)]))}});const N=(0,f.Z)(C,[["__scopeId","data-v-e59955de"]]);var R=N,I=t(12712),D=t(54354),M=t(98938),W=t(89355),j=t(43173),Z=t(29729),E=t(49316);const Y={key:1,class:"rooms__container"};var O=(0,s.aZ)({__name:"List",setup(e){const{id:a}=(0,j.Z)(),t=(0,k.tv)(),l=(0,k.yj)(),{role:c}=(0,I.Z)(),d=[{name:m.n.Chat,label:"Chats"},{name:m.n.Request,label:"Requests"}],p=(0,n.iH)(!1),_=(0,n.qj)({chats:[],activeUsers:[]}),g=(0,n.iH)(""),{mutate:v}=(0,E.Db)(U.Sq),y=(0,s.Fl)((()=>f.value&&g.value!==m.n.Chat?"Requests":"Chat History")),h=(0,s.Fl)((()=>f.value&&g.value!==m.n.Chat?"requests":"chats")),f=(0,s.Fl)((()=>c===U.g8.Trainer)),w=(0,s.Fl)((()=>l.query.type===m.n.Request.toLocaleLowerCase()));(0,s.YP)((()=>w.value),(()=>{L()}));const q=e=>{e&&(g.value=e),e===m.n.Request?t.push({name:S.N.ChatList,query:{type:m.n.Request.toLocaleLowerCase()}}):t.push({name:S.N.ChatList})},C=()=>{t.go(-1)},N=(e,a)=>{t.push({name:S.N.ChatPersonal,params:{id:a},query:{type:l.query.type?l.query.type:""}})},O=e=>!!_.activeUsers.find((a=>a===e)),T=(e,a)=>{v({id:a}).then((()=>{L()})).catch((e=>{console.log(e)}))},A=e=>Object.values(e).reduce(((e,t)=>(t?.participants?.length&&t.participants.forEach((async s=>{Number(s.user_id)===Number(a)&&e.push({...t,message:Object.values(t.messages).pop(),participant:t.participants.filter((e=>Number(e.user_id)===Number(a)))[0]})})),e.sort(((e,a)=>Number(a.message.id)-Number(e.message.id))),e)),[]),L=()=>{p.value=!0,(0,W.jM)(w.value?M.x5:M.AZ,(e=>{if(_.chats.length&&(_.chats=[]),w.value)e.forEach((e=>{if(e.key===a){const t=(0,Z.xu)(e.val(),a);_.chats.push(...t)}}));else{const t=A(e.val());t.forEach((async e=>{const t=await(0,Z.pt)(e,a);t.locked||_.chats.push(t)}))}p.value=!1}))},F=()=>{(0,W.jM)(M.AJ,(e=>{e.forEach((e=>{_.activeUsers=[..._.activeUsers,e.val()]}))}))};return(0,s.wF)((()=>{l.query.type===m.n.Request.toLocaleLowerCase()?g.value=m.n.Request:g.value=m.n.Chat})),(0,s.bv)((()=>{F(),L()})),(e,a)=>((0,s.wg)(),(0,s.iD)(s.HY,null,[(0,s.Wm)(r.Z,{"hide-navigation-menu":!f.value},{header:(0,s.w5)((()=>[(0,s.Wm)(o.Z,{"back-btn":!f.value,title:y.value,class:"page-header",onBack:C},null,8,["back-btn","title"])])),content:(0,s.w5)((()=>[p.value?((0,s.wg)(),(0,s.j4)((0,n.SU)(u.PQ),{key:0,class:"spinner"})):((0,s.wg)(),(0,s.iD)("div",Y,[_.chats.length?((0,s.wg)(),(0,s.j4)(i.W3,{key:1,name:"list",tag:"ion-item-sliding"},{default:(0,s.w5)((()=>[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(_.chats,(e=>((0,s.wg)(),(0,s.j4)(b,{key:e.key,"last-message":e.lastMessage,"room-id":e.roomId,"room-name":e.roomName,"avatar-url":e.avatar,time:e.lastTime,"is-online":O(e.participantId),type:e.type,onOpen:a=>N(a,e.roomId),onDelete:a=>T(a,e.roomId),symbols:e.symbols,unread:e.unread,class:"room-item__container"},null,8,["last-message","room-id","room-name","avatar-url","time","is-online","type","onOpen","onDelete","symbols","unread"])))),128))])),_:1})):((0,s.wg)(),(0,s.j4)(R,{key:0,title:h.value,chats:!1},null,8,["title"]))]))])),_:1},8,["hide-navigation-menu"]),f.value?((0,s.wg)(),(0,s.j4)(D.Z,{key:0,tabs:d,class:"page-tabs",onChange:q,value:g.value},null,8,["value"])):(0,s.kq)("",!0)],64))}});const T=(0,f.Z)(O,[["__scopeId","data-v-fe395232"]]);var A=T}}]);
//# sourceMappingURL=7559.9b2afe3a.js.map